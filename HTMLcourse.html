<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Interactive HTML Course</title>
<style>
  :root{
    --bg:#0f1720; --card:#0b1220; --muted:#9aa7b2; --accent:#4fc3f7; --ok:#7ef0a6; --err:#ff6b6b;
    --panel:#071023; --glass: rgba(255,255,255,0.03);
  }
  html,body{height:100%; margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Arial; background:linear-gradient(180deg,#071226 0%, #08101a 100%); color:#e6eef3;}
  .app{display:flex; gap:12px; padding:18px; box-sizing:border-box; height:100vh}
  .sidebar{width:320px; background:var(--panel); border-radius:12px; padding:14px; box-shadow:0 6px 18px rgba(2,6,23,0.6); overflow:auto}
  .main{flex:1; display:flex; flex-direction:column; gap:12px}
  h1{font-size:18px;margin:0 0 8px 0}
  .lessons{display:flex;flex-direction:column;gap:6px;margin-bottom:8px}
  .lesson-btn{display:flex;align-items:center;justify-content:space-between;padding:8px;border-radius:8px;background:var(--glass);border:1px solid rgba(255,255,255,0.03);cursor:pointer}
  .lesson-btn.active{outline:2px solid var(--accent)}
  .meta{font-size:13px;color:var(--muted)}
  .content{display:grid;grid-template-columns:1fr 380px;gap:12px;align-items:start}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);}
  .editor-wrap{display:flex;flex-direction:column;gap:8px}
  textarea.editor{width:100%;height:360px;background:#081018;color:#dff5ff;padding:12px;border-radius:8px;border:0;resize:vertical;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;font-size:13px;line-height:1.45}
  .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  button.btn{background:var(--accent);color:#00121a;border:0;padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:600}
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
  .iframe-wrap{height:360px;border-radius:8px;overflow:hidden;border:1px solid rgba(255,255,255,0.03)}
  iframe.preview{width:100%;height:100%;border:0;background:white}
  .right-col{display:flex;flex-direction:column;gap:8px}
  .viz{height:200px;overflow:auto;padding:8px;background:rgba(6,10,18,0.6);border-radius:8px;border:1px solid rgba(255,255,255,0.02);font-family:ui-monospace,monospace;font-size:13px}
  .status{padding:8px;border-radius:8px;color:#00121a;font-weight:700}
  .status.ok{background:var(--ok)}
  .status.fail{background:var(--err)}
  .hint{font-size:13px;color:var(--muted);background:transparent}
  .progress{margin-top:6px;font-size:13px;color:var(--muted)}
  .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
  footer{font-size:12px;color:var(--muted);text-align:center;padding:8px}
  .small{padding:6px 8px;border-radius:6px;font-size:13px}
  .test-list{display:flex;flex-direction:column;gap:6px}
  .test-item{padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);font-size:13px;display:flex;justify-content:space-between;align-items:center}
  .hint-box{background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);color:var(--muted)}
  .download{margin-left:auto}
  @media (max-width:1000px){ .content{grid-template-columns:1fr} .sidebar{display:none} }
</style>
</head>
<body>
<div class="app" role="application" aria-label="Interactive HTML Course">
  <aside class="sidebar card" id="sidebar">
    <h1>HTML Course — 10 Lessons</h1>
    <div class="meta">Hands-on: edit code, run it, see DOM visualizations, and get instant feedback. Progress saves locally.</div>
    <div class="lessons" id="lessonsList" style="margin-top:12px"></div>
    <div style="margin-top:10px">
      <div class="meta">Progress</div>
      <div class="progress" id="progressText">0 / 10 completed</div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="btn small" id="resetProgress">Reset Progress</button>
        <button class="ghost small" id="downloadAll">Download Current</button>
      </div>
    </div>
    <hr style="border:0;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0" />
    <div class="meta">Course is modular — lessons are data-driven and easy to extend. Open-source, single HTML file.</div>
  </aside>

  <main class="main">
    <div class="topbar">
      <div>
        <strong id="lessonTitle">Lesson</strong>
        <div class="meta" id="lessonSubtitle"></div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <div class="meta">Current user: <strong id="userName">Learner</strong></div>
        <button class="ghost small" id="prevLesson">Prev</button>
        <button class="ghost small" id="nextLesson">Next</button>
      </div>
    </div>

    <div class="content">
      <section>
        <div class="card editor-wrap" role="region" aria-label="Editor area">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="meta">Instructions</div>
              <div id="lessonDesc" style="font-size:14px;margin-top:6px;color:var(--muted)"></div>
            </div>
            <div style="display:flex;gap:8px;align-items:center">
              <button class="ghost small" id="hintBtn">Show Hint</button>
              <button class="btn small" id="resetBtn">Reset</button>
            </div>
          </div>

          <textarea id="editor" class="editor" spellcheck="false" aria-label="Code editor"></textarea>

          <div class="controls">
            <button class="btn" id="runBtn">Run →</button>
            <button class="btn" id="checkBtn">Check ✅</button>
            <div id="statusHolder" style="margin-left:8px"></div>
            <div style="margin-left:auto;display:flex;gap:8px">
              <button class="ghost small" id="prevAttempt">Undo edit</button>
              <button class="ghost small" id="downloadBtn">Download HTML</button>
            </div>
          </div>
        </div>

        <div style="display:flex;gap:12px;margin-top:8px">
          <div class="card" style="flex:1">
            <div class="meta">Live Preview (sandbox)</div>
            <div class="iframe-wrap" id="iframeWrap"><iframe id="preview" class="preview" sandbox="allow-scripts"></iframe></div>
          </div>
          <div class="card" style="width:240px">
            <div class="meta">DOM Tree Visualization</div>
            <div class="viz" id="domViz" aria-live="polite" role="log">(preview not run yet)</div>
          </div>
        </div>

      </section>

      <aside class="right-col">
        <div class="card">
          <div class="meta">Tests</div>
          <div id="tests" class="test-list" style="margin-top:8px"></div>
        </div>

        <div class="card hint-box" id="hintBox" style="display:none">
          <div class="meta">Hint</div>
          <div id="hintText" style="margin-top:8px;color:var(--muted)"></div>
        </div>

        <div class="card">
          <div class="meta">Lesson flow</div>
          <ol style="padding-left:18px;margin:8px 0;color:var(--muted)">
            <li>Read instructions</li>
            <li>Edit the HTML on the left</li>
            <li>Run to preview</li>
            <li>Check to verify tests</li>
            <li>Move to next lesson when green ✅</li>
          </ol>
        </div>

        <div class="card">
          <div class="meta">Resources</div>
          <ul style="margin:8px 0;color:var(--muted)">
            <li><a href="https://developer.mozilla.org/en-US/docs/Web/HTML" target="_blank" rel="noopener" style="color:var(--accent)">MDN — HTML reference</a></li>
            <li><a href="#" id="previewLink" style="color:var(--accent)">Preview link (paste here)</a></li>
          </ul>
        </div>

      </aside>
    </div>

    <footer class="card">
      Built with ❤️ in a single file. Lessons are data-driven — open the file and edit the `LESSONS` array to add or change content.
    </footer>
  </main>
</div>

<script>
/* ===========================
   Course data (10 modular lessons)
   Each lesson: title, desc, starterCode, hint, tests (functions that receive doc and return {ok,msg})
   =========================== */
const LESSONS = [
  {
    id: 'l1',
    title: 'Lesson 1 — Basic HTML page',
    desc: 'Create a minimal HTML page with a <!doctype>, <html>, <head> and <body>. Add a title in <head> and a visible heading <h1> in the body.',
    starter: `<!doctype html>
<html>
  <head>
    <title>My Page</title>
  </head>
  <body>
    <h1>Hello world</h1>
  </body>
</html>`,
    hint: 'Every HTML page starts with <!doctype html>. Put visible content inside <body> and page title in <title>.',
    tests: [
      doc => {
        const ok = doc.querySelector('html') !== null;
        return {ok, msg: ok ? 'Has <html> element' : 'Missing <html> element'};
      },
      doc => {
        const ok = !!doc.querySelector('head > title');
        return {ok, msg: ok ? 'Has <title>' : 'Add a <title> inside <head>'};
      },
      doc => {
        const ok = !!doc.querySelector('body > h1');
        return {ok, msg: ok ? 'Has <h1> in body' : 'Add an <h1> inside <body>'};
      }
    ]
  },
  {
    id: 'l2',
    title: 'Lesson 2 — Text and paragraphs',
    desc: 'Add a main heading and two paragraphs. Use semantic tags: <main>, <h1>, and <p>.',
    starter: `<!doctype html>
<html><head><title>Text</title></head><body>
<main>
  <h1>About me</h1>
  <p>This is my first paragraph.</p>
  <p>This is my second paragraph.</p>
</main>
</body></html>`,
    hint: 'Use <main> to wrap primary content. Paragraphs are <p> tags.',
    tests: [
      doc => ({ ok: !!doc.querySelector('main'), msg: 'Has <main>' }),
      doc => ({ ok: !!doc.querySelector('main > h1'), msg: 'Heading inside <main>' }),
      doc => ({ ok: doc.querySelectorAll('main > p').length >= 2, msg: 'At least two <p> inside <main>' })
    ]
  },
  {
    id: 'l3',
    title: 'Lesson 3 — Links and anchors',
    desc: 'Create two links: one to https://example.com (external), and one anchor to a #contact section on the same page.',
    starter: `<!doctype html><html><head><title>Links</title></head><body>
<nav>
  <a href="https://example.com" target="_blank" rel="noopener">External</a>
  <a href="#contact">Contact</a>
</nav>

<section id="contact">
  <h2>Contact</h2>
  <p>email@example.com</p>
</section>
</body></html>`,
    hint: 'Use <a href="..."> for links. For same-page anchor use href="#id".',
    tests: [
      doc => ({ ok: !!doc.querySelector('a[href^="https://example.com"]'), msg: 'Has link to example.com' }),
      doc => ({ ok: !!doc.querySelector('a[href="#contact"]'), msg: 'Has anchor linking to #contact' }),
      doc => ({ ok: !!doc.querySelector('#contact'), msg: 'Has element with id="contact"' })
    ]
  },
  {
    id: 'l4',
    title: 'Lesson 4 — Images',
    desc: 'Insert an image with an appropriate alt attribute. Use a placeholder image (data URL or any URL).',
    starter: `<!doctype html><html><head><title>Image</title></head><body>
<img src="https://via.placeholder.com/240x120.png?text=Demo" alt="Demo image">
</body></html>`,
    hint: 'Always include alt text for accessibility.',
    tests: [
      doc => {
        const img = doc.querySelector('img');
        const ok = !!img && img.getAttribute('alt') && img.getAttribute('alt').trim().length>0;
        return { ok, msg: ok ? 'Image element with alt' : 'Add <img> with a non-empty alt attribute' };
      }
    ]
  },
  {
    id: 'l5',
    title: 'Lesson 5 — Lists',
    desc: 'Create an ordered list (<ol>) of three tasks and an unordered list (<ul>) of three grocery items.',
    starter: `<!doctype html><html><head><title>Lists</title></head><body>
<h2>Tasks</h2>
<ol>
  <li>Step one</li>
  <li>Step two</li>
  <li>Step three</li>
</ol>

<h2>Groceries</h2>
<ul>
  <li>Milk</li>
  <li>Bread</li>
  <li>Eggs</li>
</ul>
</body></html>`,
    hint: 'Ordered lists use <ol>, unordered <ul>. Each item is <li>.',
    tests: [
      doc => ({ ok: doc.querySelectorAll('ol > li').length >= 3, msg: 'Ordered list with 3 items' }),
      doc => ({ ok: doc.querySelectorAll('ul > li').length >= 3, msg: 'Unordered list with 3 items' })
    ]
  },
  {
    id: 'l6',
    title: 'Lesson 6 — Tables',
    desc: 'Create a simple table with a header row and two data rows (2 columns).',
    starter: `<!doctype html><html><head><title>Table</title></head><body>
<table border="1">
  <thead><tr><th>Name</th><th>Age</th></tr></thead>
  <tbody>
    <tr><td>Alice</td><td>30</td></tr>
    <tr><td>Bob</td><td>25</td></tr>
  </tbody>
</table>
</body></html>`,
    hint: 'Use <table>, <thead>, <tbody>, <tr>, <th>, <td> for semantic tables.',
    tests: [
      doc => ({ ok: !!doc.querySelector('table'), msg: 'Has <table>' }),
      doc => ({ ok: !!doc.querySelector('thead tr th'), msg: 'Header cells present' }),
      doc => ({ ok: doc.querySelectorAll('tbody tr').length >= 2, msg: 'At least two data rows' })
    ]
  },
  {
    id: 'l7',
    title: 'Lesson 7 — Forms (basic)',
    desc: 'Build a form with name (text input), email (type="email"), and a submit button. Include labels.',
    starter: `<!doctype html><html><head><title>Form</title></head><body>
<form>
  <label>Name: <input type="text" name="name"></label><br>
  <label>Email: <input type="email" name="email"></label><br>
  <button type="submit">Send</button>
</form>
</body></html>`,
    hint: 'Use <label> to associate text with inputs for accessibility.',
    tests: [
      doc => ({ ok: !!doc.querySelector('form'), msg: 'Has <form>' }),
      doc => ({ ok: !!doc.querySelector('input[type="email"]'), msg: 'Email input present' }),
      doc => ({ ok: !!doc.querySelector('button[type="submit"]'), msg: 'Submit button present' })
    ]
  },
  {
    id: 'l8',
    title: 'Lesson 8 — Semantic tags',
    desc: 'Structure a small page using <header>, <nav>, <main>, <article>, and <footer>.',
    starter: `<!doctype html><html><head><title>Semantic</title></head><body>
<header><h1>Site Title</h1></header>
<nav><a href="#">Home</a> | <a href="#">About</a></nav>
<main>
  <article><h2>Article Title</h2><p>Article body...</p></article>
</main>
<footer>©️ 2025</footer>
</body></html>`,
    hint: 'Semantic tags help machines and accessibility tools understand page structure.',
    tests: [
      doc => ({ ok: !!doc.querySelector('header'), msg: 'Has <header>' }),
      doc => ({ ok: !!doc.querySelector('nav'), msg: 'Has <nav>' }),
      doc => ({ ok: !!doc.querySelector('main'), msg: 'Has <main>' }),
      doc => ({ ok: !!doc.querySelector('footer'), msg: 'Has <footer>' })
    ]
  },
  {
    id: 'l9',
    title: 'Lesson 9 — Media & iframes',
    desc: 'Embed a YouTube video using an <iframe> (use a safe example URL) and add an accessible title attribute.',
    starter: `<!doctype html><html><head><title>Media</title></head><body>
<iframe width="320" height="180"
  src="https://www.youtube.com/embed/dQw4w9WgXcQ"
  title="Demo video" allowfullscreen></iframe>
</body></html>`,
    hint: 'Use title on iframes for screen readers. You can also use <video> for local media.',
    tests: [
      doc => ({ ok: !!doc.querySelector('iframe'), msg: 'Has <iframe>' }),
      doc => ({ ok: !!doc.querySelector('iframe[title]'), msg: 'Iframe includes title attribute' })
    ]
  },
  {
    id: 'l10',
    title: 'Lesson 10 — Accessibility basics',
    desc: 'Add alt text for images, add labels for form fields, and include lang attribute on <html>. Check basic accessibility attributes.',
    starter: `<!doctype html><html lang="en"><head><title>Accessibility</title></head><body>
<img src="https://via.placeholder.com/80" alt="placeholder">
<form>
  <label>Email: <input type="email" name="email"></label>
  <button type="submit">Send</button>
</form>
</body></html>`,
    hint: 'lang on <html>, labels for inputs, and alt on images are simple but powerful.',
    tests: [
      doc => ({ ok: document.documentElement.lang === 'en' || !!document.documentElement.lang, msg: 'lang attribute on <html>' }),
      doc => ({ ok: !!doc.querySelector('img[alt]'), msg: 'Images have alt attributes' }),
      doc => ({ ok: !!doc.querySelector('label'), msg: 'Form fields labeled' })
    ]
  }
];

/* ===========================
   App logic
   =========================== */

const state = {
  lessonIndex: 0,
  history: [],
  historyPos: -1,
  completed: JSON.parse(localStorage.getItem('html_course_completed')||'{}')
};

const elements = {
  lessonsList: document.getElementById('lessonsList'),
  lessonTitle: document.getElementById('lessonTitle'),
  lessonSubtitle: document.getElementById('lessonSubtitle'),
  lessonDesc: document.getElementById('lessonDesc'),
  editor: document.getElementById('editor'),
  preview: document.getElementById('preview'),
  domViz: document.getElementById('domViz'),
  testsEl: document.getElementById('tests'),
  hintBox: document.getElementById('hintBox'),
  hintText: document.getElementById('hintText'),
  hintBtn: document.getElementById('hintBtn'),
  runBtn: document.getElementById('runBtn'),
  checkBtn: document.getElementById('checkBtn'),
  resetBtn: document.getElementById('resetBtn'),
  nextLesson: document.getElementById('nextLesson'),
  prevLesson: document.getElementById('prevLesson'),
  progressText: document.getElementById('progressText'),
  statusHolder: document.getElementById('statusHolder'),
  downloadBtn: document.getElementById('downloadBtn'),
  downloadAll: document.getElementById('downloadAll'),
  prevAttempt: document.getElementById('prevAttempt'),
  resetProgress: document.getElementById('resetProgress'),
  previewLink: document.getElementById('previewLink'),
  userName: document.getElementById('userName')
};

function renderLessonsList(){
  elements.lessonsList.innerHTML = '';
  LESSONS.forEach((ls, i)=>{
    const btn = document.createElement('div');
    btn.className = 'lesson-btn' + (i===state.lessonIndex ? ' active' : '');
    btn.dataset.idx = i;
    btn.innerHTML = `<div style="font-weight:700">${i+1}. ${ls.title}</div>
      <div style="display:flex;flex-direction:column;align-items:flex-end">
        <div class="meta">${ls.desc.split('.')[0]}</div>
        <div style="font-size:12px;color:${state.completed[ls.id] ? 'var(--ok)' : 'var(--muted)'}">${state.completed[ls.id] ? 'Completed' : ''}</div>
      </div>`;
    btn.addEventListener('click', ()=>{ loadLesson(i); });
    elements.lessonsList.appendChild(btn);
  });
}

function loadLesson(index){
  state.lessonIndex = index;
  const lesson = LESSONS[index];
  elements.lessonTitle.textContent = `${index+1}. ${lesson.title}`;
  elements.lessonSubtitle.textContent = lesson.desc;
  elements.lessonDesc.textContent = lesson.desc;
  elements.editor.value = lesson.starter;
  state.history = [lesson.starter];
  state.historyPos = 0;
  renderTests();
  renderLessonsList();
  elements.hintBox.style.display = 'none';
  setStatus(null);
  runPreview();
}

function setStatus(obj){
  const holder = elements.statusHolder;
  holder.innerHTML = '';
  if(!obj) return;
  const div = document.createElement('div');
  div.className = 'status ' + (obj.ok ? 'ok' : 'fail');
  div.textContent = obj.msg;
  holder.appendChild(div);
}

function renderTests(){
  const tests = LESSONS[state.lessonIndex].tests;
  elements.testsEl.innerHTML = '';
  tests.forEach((t, i)=>{
    const item = document.createElement('div');
    item.className = 'test-item';
    item.dataset.idx = i;
    item.innerHTML = `<div class="meta">Test ${i+1}</div><div id="t-${i}" class="meta" style="color:var(--muted)">Not run</div>`;
    elements.testsEl.appendChild(item);
  });
}

function runPreview(){
  const html = elements.editor.value;
  // write to iframe
  const preview = elements.preview;
  // sandbox: allow-scripts but no top-level navigation
  preview.srcdoc = html;
  // update DOM viz after load
  preview.addEventListener('load', updateDomViz, {once:true});
}

function updateDomViz(){
  const doc = elements.preview.contentDocument;
  if(!doc) return elements.domViz.textContent = '(no preview)';
  // build an indented tree (limited depth)
  function nodeToString(node, depth=0){
    const indent = '  '.repeat(depth);
    if(node.nodeType === 3){ // text
      const text = node.textContent.trim();
      return text ? indent + `#text "${text.slice(0,40)}"` : '';
    }
    if(node.nodeType !== 1) return '';
    let out = indent + `<${node.tagName.toLowerCase()}`;
    if(node.id) out += ` id="${node.id}"`;
    if(node.className) out += ` class="${node.className}"`;
    out += '>';
    if(depth >= 6) return out;
    const children = Array.from(node.childNodes).map(n=>nodeToString(n, depth+1)).filter(Boolean).join('\n');
    return children ? out + '\n' + children + '\n' + indent + `</${node.tagName.toLowerCase()}>` : out + `</${node.tagName.toLowerCase()}>`;
  }
  const body = doc.body;
  const tree = nodeToString(body, 0);
  elements.domViz.textContent = tree || '(empty body)';
}

function runTests(){
  const html = elements.editor.value;
  // parse with DOMParser to avoid cross-domain iframe complexities
  const parser = new DOMParser();
  const doc = parser.parseFromString(html, 'text/html');
  const tests = LESSONS[state.lessonIndex].tests;
  let allOk = true;
  tests.forEach((t, i)=>{
    let res = {ok:false, msg:'(test threw)'};
    try {
      res = t(doc) || {ok:false, msg:'No result'};
      if(typeof res === 'string') res = {ok:false, msg:res};
    } catch(err){
      res = {ok:false, msg:'Error: '+err.message};
    }
    const el = document.getElementById('t-'+i);
    el.textContent = res.msg;
    el.style.color = res.ok ? 'var(--ok)' : 'var(--err)';
    if(!res.ok) allOk = false;
  });
  if(allOk){
    setStatus({ok:true,msg:'All tests passed ✅'});
    markCompleted(LESSONS[state.lessonIndex].id);
  } else {
    setStatus({ok:false,msg:'Some tests failed — see details'});
  }
  return allOk;
}

function markCompleted(id){
  state.completed[id] = true;
  localStorage.setItem('html_course_completed', JSON.stringify(state.completed));
  updateProgressText();
  renderLessonsList();
}

function updateProgressText(){
  const done = Object.keys(state.completed).length;
  elements.progressText.textContent = `${done} / ${LESSONS.length} completed`;
}

/* Controls */
elements.runBtn.addEventListener('click', ()=>{
  saveHistory(elements.editor.value);
  runPreview();
});
elements.checkBtn.addEventListener('click', ()=> runTests());
elements.hintBtn.addEventListener('click', ()=>{
  const lesson = LESSONS[state.lessonIndex];
  elements.hintText.textContent = lesson.hint;
  elements.hintBox.style.display = 'block';
});
elements.resetBtn.addEventListener('click', ()=>{
  const lesson = LESSONS[state.lessonIndex];
  if(confirm('Reset editor to starter code for this lesson?')) loadLesson(state.lessonIndex);
});
elements.nextLesson.addEventListener('click', ()=>{
  if(state.lessonIndex < LESSONS.length-1) loadLesson(state.lessonIndex+1);
});
elements.prevLesson.addEventListener('click', ()=>{
  if(state.lessonIndex > 0) loadLesson(state.lessonIndex-1);
});
elements.downloadBtn.addEventListener('click', ()=>{
  const blob = new Blob([elements.editor.value], {type:'text/html'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `lesson-${state.lessonIndex+1}.html`;
  a.click();
});
elements.downloadAll.addEventListener('click', ()=>{
  const html = elements.editor.value;
  const blob = new Blob([html], {type:'text/html'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `photoFree-lesson-${state.lessonIndex+1}.html`;
  a.click();
});
elements.prevAttempt.addEventListener('click', ()=>{
  if(state.historyPos > 0){
    state.historyPos--;
    elements.editor.value = state.history[state.historyPos];
  } else alert('No older edits in this session (only since lesson load).');
});
elements.resetProgress.addEventListener('click', ()=>{
  if(confirm('Reset all progress?')) {
    localStorage.removeItem('html_course_completed');
    state.completed = {};
    updateProgressText();
    renderLessonsList();
  }
});

/* Editor change tracking (simple) */
elements.editor.addEventListener('input', ()=>{
  // not saving every keystroke into history. Use run to snapshot.
});

/* history */
function saveHistory(content){
  // keep small history per lesson
  state.history = state.history.slice(0, state.historyPos+1);
  state.history.push(content);
  state.historyPos = state.history.length - 1;
  if(state.history.length > 50) state.history.shift(), state.historyPos--;
}

/* preview link placeholder: let user paste a link where they host the single-file preview */
elements.previewLink.addEventListener('click', (e)=>{
  e.preventDefault();
  const url = prompt('Paste a public preview URL (optional):', elements.previewLink.href === '#' ? '' : elements.previewLink.href);
  if(url) elements.previewLink.href = url, elements.previewLink.textContent = 'Preview link set';
});

/* initial load */
(function init(){
  renderLessonsList();
  loadLesson(0);
  updateProgressText();
  elements.userName.textContent = 'Learner';
})();

/* Keyboard: Ctrl+Enter to run */
document.addEventListener('keydown', (e)=>{
  if((e.ctrlKey||e.metaKey) && e.key === 'Enter'){
    e.preventDefault(); saveHistory(elements.editor.value); runPreview();
  }
});

/* Export function for full course state (optional) */
function downloadCourseState(){
  const stateObj = {
    lessonIndex: state.lessonIndex,
    editorText: elements.editor.value,
    completed: state.completed
  };
  const blob = new Blob([JSON.stringify(stateObj, null, 2)], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'photoFree-course-state.json';
  a.click();
}

/* Accessibility: announce tests completed (aria-live) */
const ariaLive = document.createElement('div');
ariaLive.setAttribute('aria-live','polite');
ariaLive.style.position='absolute'; ariaLive.style.left='-9999px';
document.body.appendChild(ariaLive);

</script>
</body>
</html>
